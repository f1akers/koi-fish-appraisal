# Koi Fish Appraisal - Backend

FastAPI backend for koi fish appraisal using computer vision and machine learning.

## Setup

### Prerequisites
- Python 3.10+
- pip

### Installation

```bash
# Create virtual environment
python -m venv venv

# Activate virtual environment
# Windows
.\venv\Scripts\activate
# Linux/Mac
source venv/bin/activate

# Install dependencies
pip install -r requirements.txt
```

### Running the Server

```bash
# Development
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000

# Production
uvicorn app.main:app --host 0.0.0.0 --port 8000
```

## Project Structure

```
backend/
├── app/
│   ├── __init__.py
│   ├── main.py              # FastAPI application entry
│   ├── config.py            # Configuration and constants
│   ├── routers/
│   │   ├── __init__.py
│   │   └── appraisal.py     # Appraisal endpoints
│   ├── services/
│   │   ├── __init__.py
│   │   ├── size_detection.py
│   │   ├── pattern_detection.py
│   │   ├── color_analysis.py
│   │   ├── symmetry_analysis.py
│   │   └── price_prediction.py
│   ├── schemas/
│   │   ├── __init__.py
│   │   └── appraisal.py     # Pydantic models
│   └── utils/
│       ├── __init__.py
│       ├── image_utils.py
│       └── feature_extraction.py
├── models/                   # ML model files
│   ├── .gitkeep
│   ├── koi-segment.pt
│   ├── coin.pt
│   ├── koi-pattern.pt
│   └── linear.pkl
├── images/                   # Training images
│   └── .gitkeep
├── tests/
│   ├── __init__.py
│   └── test_appraisal.py
├── requirements.txt
└── README.md
```

## API Documentation

Once running, visit:
- Swagger UI: http://localhost:8000/docs
- ReDoc: http://localhost:8000/redoc

## Models

Place the following model files in the `models/` directory:
- `koi-segment.pt` - YOLOv8 instance segmentation model for koi fish
- `coin.pt` - YOLOv8 detection model for reference coins
- `koi-pattern.pt` - YOLOv8 classification model for patterns
- `linear.pkl` - Trained linear regression model (generated by trainer)

## Training

To train the linear regression model:

```bash
python -m app.train --csv path/to/training_data.csv
```

## Environment Variables

Create a `.env` file:

```env
DEBUG=true
MODEL_PATH=./models
ALLOWED_ORIGINS=http://localhost:5173
```
